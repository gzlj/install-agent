[WARNING]: Consider using the yum module rather than running 'yum'.  If you
need to use command because yum is insufficient you can add 'warn: false' to
this command task or set 'command_warnings=False' in ansible.cfg to get rid of
this message.
[WARNING]: Consider using the file module with state=absent rather than running
'rm'.  If you need to use command because file is insufficient you can add
'warn: false' to this command task or set 'command_warnings=False' in
ansible.cfg to get rid of this message.
[WARNING]: Could not match supplied host pattern, ignoring: node
uginfo.repo)
ok: [192.168.26.129] => (item=CentOS-Media.repo)
ok: [192.168.26.129] => (item=CentOS-Vault.repo)
ok: [192.168.26.129] => (item=CentOS-CR.repo)
ok: [192.168.26.129] => (item=CentOS-fasttrack.repo)
ok: [192.168.26.129] => (item=CentOS-Sources.repo)

TASK [common : get aliyun Centos-7.repo epel-7.repo] ***************************
ok: [192.168.26.129] => (item={u'url': u'Centos-7.repo', u'dest': u'CentOS-7.repo'})
ok: [192.168.26.129] => (item={u'url': u'epel-7.repo', u'dest': u'epel-7.repo'})

TASK [common : yum install wget net-tools ntpdate vim lrzsz ipvsadm ipset] *****
ok: [192.168.26.129]

TASK [common : centos_optimization] ********************************************
changed: [192.168.26.129]

TASK [common : close swap] *****************************************************
changed: [192.168.26.129]

TASK [docker : set up /etc/sysctl.d/k8s.conf] **********************************
ok: [192.168.26.129]

TASK [docker : load kernel modules] ********************************************
changed: [192.168.26.129]

TASK [docker : aliyun docker-ce repo] ******************************************
ok: [192.168.26.129]

TASK [docker : clean old docker bin package] ***********************************
changed: [192.168.26.129]

TASK [docker : yum install docker-ce] ******************************************
changed: [192.168.26.129]

TASK [docker : set upt /etc/docker dir] ****************************************
ok: [192.168.26.129]

TASK [docker : push docker config script to remote host] ***********************
ok: [192.168.26.129]

TASK [docker : docker daemon json file] ****************************************
changed: [192.168.26.129]

TASK [docker : update xfsprogs] ************************************************
changed: [192.168.26.129]

TASK [docker : set up docker.service file] *************************************
changed: [192.168.26.129]

TASK [docker : restart docker] *************************************************
changed: [192.168.26.129]

TASK [docker : docker auto start] **********************************************
changed: [192.168.26.129]

TASK [private-registry : set up a private docker registry] *********************
changed: [192.168.26.129]

TASK [private-registry : download and push k8s docker images] ******************
changed: [192.168.26.129]

TASK [single-master : set hostname] ********************************************
changed: [192.168.26.129]

TASK [single-master : clean keepalived] ****************************************
changed: [192.168.26.129]

TASK [single-master : clean k8s] ***********************************************
changed: [192.168.26.129]

TASK [single-master : set up aliyun yum kubernetes repo] ***********************
ok: [192.168.26.129]

TASK [single-master : set up k8s rpm version shell file] ***********************
ok: [192.168.26.129]

TASK [single-master : get rpm version by k8s version] **************************
changed: [192.168.26.129]

TASK [single-master : download and install k8s rpm] ****************************
FAILED - RETRYING: download and install k8s rpm (3 retries left).
FAILED - RETRYING: download and install k8s rpm (2 retries left).
FAILED - RETRYING: download and install k8s rpm (1 retries left).
fatal: [192.168.26.129]: FAILED! => {"attempts": 3, "changed": true, "cmd": "rpms=$( rpm -qa | egrep \"kubernetes-cni|kubelet|kubeadm|kubectl\" | tr '\\n' ' ' )\n#echo \"rpm -e $rpms\" | bash\n[[ -z \"$rpms\" ]]  || echo \"yum remove -y $rpms\" | bash\nsleep 3\nif [[ 1.18.5-0 =~ \"1.18\" ]]; then \nyum install kubeadm-1.18.5-0 kubelet-1.18.5-0 kubectl-1.18.5-0 -y --setopt=obsoletes=0 --nogpgcheck  \nelse \nyum install kubeadm-1.18.5-0 kubelet-1.18.5-0 kubectl-1.18.5-0 kubernetes-cni-0.7.5 -y --setopt=obsoletes=0 --nogpgcheck\nfi\nsystemctl daemon-reload\nsystemctl enable kubelet\n", "delta": "0:00:47.102802", "end": "2020-09-24 16:11:54.071125", "msg": "non-zero return code", "rc": 1, "start": "2020-09-24 16:11:06.968323", "stderr": "Repository epel is listed more than once in the configuration\nRepository epel-debuginfo is listed more than once in the configuration\nRepository epel-source is listed more than once in the configuration\nRepository epel is listed more than once in the configuration\nRepository epel-debuginfo is listed more than once in the configuration\nRepository epel-source is listed more than once in the configuration\nFailed to execute operation: File exists", "stderr_lines": ["Repository epel is listed more than once in the configuration", "Repository epel-debuginfo is listed more than once in the configuration", "Repository epel-source is listed more than once in the configuration", "Repository epel is listed more than once in the configuration", "Repository epel-debuginfo is listed more than once in the configuration", "Repository epel-source is listed more than once in the configuration", "Failed to execute operation: File exists"], "stdout": "已加载插件：fastestmirror, langpacks\n正在解决依赖关系\n--> 正在检查事务\n---> 软件包 kubeadm.x86_64.0.1.18.5-0 将被 删除\n---> 软件包 kubectl.x86_64.0.1.18.5-0 将被 删除\n---> 软件包 kubelet.x86_64.0.1.18.5-0 将被 删除\n---> 软件包 kubernetes-cni.x86_64.0.0.8.7-0 将被 删除\n--> 解决依赖关系完成\n\n依赖关系解决\n\n================================================================================\n Package               架构          版本              源                  大小\n================================================================================\n正在删除:\n kubeadm               x86_64        1.18.5-0          @kubernetes         38 M\n kubectl               x86_64        1.18.5-0          @kubernetes         42 M\n kubelet               x86_64        1.18.5-0          @kubernetes        108 M\n kubernetes-cni        x86_64        0.8.7-0           @kubernetes         55 M\n\n事务概要\n================================================================================\n移除  4 软件包\n\n安装大小：243 M\nDownloading packages:\nRunning transaction check\nRunning transaction test\nTransaction test succeeded\nRunning transaction\n  正在删除    : kubeadm-1.18.5-0.x86_64                                     1/4 \n  正在删除    : kubelet-1.18.5-0.x86_64                                     2/4 \n  正在删除    : kubernetes-cni-0.8.7-0.x86_64                               3/4 \n  正在删除    : kubectl-1.18.5-0.x86_64                                     4/4 \n  验证中      : kubeadm-1.18.5-0.x86_64                                     1/4 \n  验证中      : kubectl-1.18.5-0.x86_64                                     2/4 \n  验证中      : kubelet-1.18.5-0.x86_64                                     3/4 \n  验证中      : kubernetes-cni-0.8.7-0.x86_64                               4/4 \n\n删除:\n  kubeadm.x86_64 0:1.18.5-0           kubectl.x86_64 0:1.18.5-0                \n  kubelet.x86_64 0:1.18.5-0           kubernetes-cni.x86_64 0:0.8.7-0          \n\n完毕！\n已加载插件：fastestmirror, langpacks\nLoading mirror speeds from cached hostfile\n * base: mirrors.aliyun.com\n * extras: mirrors.aliyun.com\n * updates: mirrors.aliyun.com\n正在解决依赖关系\n--> 正在检查事务\n---> 软件包 kubeadm.x86_64.0.1.18.5-0 将被 安装\n--> 正在处理依赖关系 kubernetes-cni >= 0.8.6，它被软件包 kubeadm-1.18.5-0.x86_64 需要\n---> 软件包 kubectl.x86_64.0.1.18.5-0 将被 安装\n---> 软件包 kubelet.x86_64.0.1.18.5-0 将被 安装\n--> 正在检查事务\n---> 软件包 kubernetes-cni.x86_64.0.0.8.7-0 将被 安装\n--> 解决依赖关系完成\n\n依赖关系解决\n\n================================================================================\n Package               架构          版本               源                 大小\n================================================================================\n正在安装:\n kubeadm               x86_64        1.18.5-0           kubernetes        8.8 M\n kubectl               x86_64        1.18.5-0           kubernetes        9.5 M\n kubelet               x86_64        1.18.5-0           kubernetes         21 M\n为依赖而安装:\n kubernetes-cni        x86_64        0.8.7-0            kubernetes         19 M\n\n事务概要\n================================================================================\n安装  3 软件包 (+1 依赖软件包)\n\n总下载量：58 M\n安装大小：243 M\nDownloading packages:\n--------------------------------------------------------------------------------\n总计                                               1.8 MB/s |  58 MB  00:31     \nRunning transaction check\nRunning transaction test\nTransaction test succeeded\nRunning transaction\n  正在安装    : kubernetes-cni-0.8.7-0.x86_64                               1/4 \n  正在安装    : kubelet-1.18.5-0.x86_64                                     2/4 \n  正在安装    : kubectl-1.18.5-0.x86_64                                     3/4 \n  正在安装    : kubeadm-1.18.5-0.x86_64                                     4/4 \n  验证中      : kubeadm-1.18.5-0.x86_64                                     1/4 \n  验证中      : kubectl-1.18.5-0.x86_64                                     2/4 \n  验证中      : kubelet-1.18.5-0.x86_64                                     3/4 \n  验证中      : kubernetes-cni-0.8.7-0.x86_64                               4/4 \n\n已安装:\n  kubeadm.x86_64 0:1.18.5-0 kubectl.x86_64 0:1.18.5-0 kubelet.x86_64 0:1.18.5-0\n\n作为依赖被安装:\n  kubernetes-cni.x86_64 0:0.8.7-0                                               \n\n完毕！", "stdout_lines": ["已加载插件：fastestmirror, langpacks", "正在解决依赖关系", "--> 正在检查事务", "---> 软件包 kubeadm.x86_64.0.1.18.5-0 将被 删除", "---> 软件包 kubectl.x86_64.0.1.18.5-0 将被 删除", "---> 软件包 kubelet.x86_64.0.1.18.5-0 将被 删除", "---> 软件包 kubernetes-cni.x86_64.0.0.8.7-0 将被 删除", "--> 解决依赖关系完成", "", "依赖关系解决", "", "================================================================================", " Package               架构          版本              源                  大小", "================================================================================", "正在删除:", " kubeadm               x86_64        1.18.5-0          @kubernetes         38 M", " kubectl               x86_64        1.18.5-0          @kubernetes         42 M", " kubelet               x86_64        1.18.5-0          @kubernetes        108 M", " kubernetes-cni        x86_64        0.8.7-0           @kubernetes         55 M", "", "事务概要", "================================================================================", "移除  4 软件包", "", "安装大小：243 M", "Downloading packages:", "Running transaction check", "Running transaction test", "Transaction test succeeded", "Running transaction", "  正在删除    : kubeadm-1.18.5-0.x86_64                                     1/4 ", "  正在删除    : kubelet-1.18.5-0.x86_64                                     2/4 ", "  正在删除    : kubernetes-cni-0.8.7-0.x86_64                               3/4 ", "  正在删除    : kubectl-1.18.5-0.x86_64                                     4/4 ", "  验证中      : kubeadm-1.18.5-0.x86_64                                     1/4 ", "  验证中      : kubectl-1.18.5-0.x86_64                                     2/4 ", "  验证中      : kubelet-1.18.5-0.x86_64                                     3/4 ", "  验证中      : kubernetes-cni-0.8.7-0.x86_64                               4/4 ", "", "删除:", "  kubeadm.x86_64 0:1.18.5-0           kubectl.x86_64 0:1.18.5-0                ", "  kubelet.x86_64 0:1.18.5-0           kubernetes-cni.x86_64 0:0.8.7-0          ", "", "完毕！", "已加载插件：fastestmirror, langpacks", "Loading mirror speeds from cached hostfile", " * base: mirrors.aliyun.com", " * extras: mirrors.aliyun.com", " * updates: mirrors.aliyun.com", "正在解决依赖关系", "--> 正在检查事务", "---> 软件包 kubeadm.x86_64.0.1.18.5-0 将被 安装", "--> 正在处理依赖关系 kubernetes-cni >= 0.8.6，它被软件包 kubeadm-1.18.5-0.x86_64 需要", "---> 软件包 kubectl.x86_64.0.1.18.5-0 将被 安装", "---> 软件包 kubelet.x86_64.0.1.18.5-0 将被 安装", "--> 正在检查事务", "---> 软件包 kubernetes-cni.x86_64.0.0.8.7-0 将被 安装", "--> 解决依赖关系完成", "", "依赖关系解决", "", "================================================================================", " Package               架构          版本               源                 大小", "================================================================================", "正在安装:", " kubeadm               x86_64        1.18.5-0           kubernetes        8.8 M", " kubectl               x86_64        1.18.5-0           kubernetes        9.5 M", " kubelet               x86_64        1.18.5-0           kubernetes         21 M", "为依赖而安装:", " kubernetes-cni        x86_64        0.8.7-0            kubernetes         19 M", "", "事务概要", "================================================================================", "安装  3 软件包 (+1 依赖软件包)", "", "总下载量：58 M", "安装大小：243 M", "Downloading packages:", "--------------------------------------------------------------------------------", "总计                                               1.8 MB/s |  58 MB  00:31     ", "Running transaction check", "Running transaction test", "Transaction test succeeded", "Running transaction", "  正在安装    : kubernetes-cni-0.8.7-0.x86_64                               1/4 ", "  正在安装    : kubelet-1.18.5-0.x86_64                                     2/4 ", "  正在安装    : kubectl-1.18.5-0.x86_64                                     3/4 ", "  正在安装    : kubeadm-1.18.5-0.x86_64                                     4/4 ", "  验证中      : kubeadm-1.18.5-0.x86_64                                     1/4 ", "  验证中      : kubectl-1.18.5-0.x86_64                                     2/4 ", "  验证中      : kubelet-1.18.5-0.x86_64                                     3/4 ", "  验证中      : kubernetes-cni-0.8.7-0.x86_64                               4/4 ", "", "已安装:", "  kubeadm.x86_64 0:1.18.5-0 kubectl.x86_64 0:1.18.5-0 kubelet.x86_64 0:1.18.5-0", "", "作为依赖被安装:", "  kubernetes-cni.x86_64 0:0.8.7-0                                               ", "", "完毕！"]}
...ignoring

TASK [single-master : set up opt dir] ******************************************
ok: [192.168.26.129]

TASK [single-master : download kubeadm binary] *********************************
changed: [192.168.26.129]

TASK [single-master : mv kubeadm binary to /usr/bin/] **************************
changed: [192.168.26.129]

TASK [single-master : flannel yaml] ********************************************
ok: [192.168.26.129]

TASK [single-master : calico yaml] *********************************************
ok: [192.168.26.129]

TASK [single-master : push monitoring files to remote host] ********************
ok: [192.168.26.129]

TASK [single-master : push app plan files to remote host] **********************
changed: [192.168.26.129]

TASK [single-master : push ceph fs files to remote host] ***********************
changed: [192.168.26.129]

TASK [single-master : push ceph rbd files to remote host] **********************
ok: [192.168.26.129]

TASK [single-master : delete old kubeamd config file] **************************
changed: [192.168.26.129]

TASK [single-master : kubeadm] *************************************************
changed: [192.168.26.129]

TASK [single-master : bootstrap k8s] *******************************************
changed: [192.168.26.129]

TASK [single-master : deploy prometheus pods] **********************************
changed: [192.168.26.129]

TASK [single-master : deploy ceph provisioner pod] *****************************
changed: [192.168.26.129]

TASK [single-master : deploy app plan] *****************************************
changed: [192.168.26.129]

TASK [single-master : restart kubelet] *****************************************
changed: [192.168.26.129]

PLAY [node] ********************************************************************
skipping: no hosts matched

PLAY RECAP *********************************************************************
192.168.26.129             : ok=45   changed=31   unreachable=0    failed=0    skipped=0    rescued=0    ignored=1   

