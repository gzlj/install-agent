- name: set up a private docker registry
  shell: |
    docker ps | grep 5000.*registry > /dev/null 2>&1 && exit 0
    docker run -d -p {{ private_registry_port | default('5000') }}:5000 -e REGISTRY_STORAGE_DELETE_ENABLED=true -v /home/data/registrydata/:/var/lib/registry --restart=always --name registry ocscaas/registry:2.6.2
    while :
    do
        docker ps | grep 5000.*registry > /dev/null 2>&1 && break || sleep 5
    done
    sleep 5
